{% extends "base.html" %}

{% block navigation %}
  <div class="hlist"><ul>
    <li><a href="{% url bawebauth.views.show_home %}" title="Home">Home</a></li>
    <li class="active"><strong>Dashboard</strong></li>
  </ul></div>
{% endblock %}

{% block content %}
  {% if device %}
  {% if device_edit_form %}
  <form action="{% url bawebauth.views.edit_device device.id %}" method="post" class="yform columnar">{% csrf_token %}
  <fieldset>
    <legend><img src="{{ STATIC_URL }}icons/pencil.png" alt="" /> <strong>Edit Device:</strong></legend>
    {{ device_edit_form.as_yaml }}
    <div class="type-button">
      <input type="submit" name="submit" value="Save Device" />
      <a href="{% url bawebauth.views.show_dashboard %}" title="Close"><input type="button" name="close" value="Close" /></a>
    </div>
  </fieldset>
  </form>
  {% else %}
  <div id="chart_usage" style="width: 652px; height: 280px;"></div><br />
  <script type='text/javascript'>
    google.load('visualization', '1', {'packages': ['annotatedtimeline']});
    google.setOnLoadCallback(drawChart);

    function drawChart() {
      var chart = new google.visualization.AnnotatedTimeLine(document.getElementById('chart_usage'));
      var data = new google.visualization.DataTable();

      data.addColumn('datetime', 'Date');
      data.addColumn('number', 'Send');
      data.addColumn('number', 'Received');
      data.addRows([
        {% for usage in device.usages %}
        [new Date({{ usage.crdate.year }}, {{ usage.crdate.month }}, {{ usage.crdate.day }}, {{ usage.crdate.hour }}, {{ usage.crdate.minute }}, {{ usage.crdate.second }}), {{ usage.send }}, {{ usage.received }}],
        {% endfor %}
      ]);

      chart.draw(data, {
        'scaleType': 'maximized',
        {% if yesterday %}'zoomStartTime': new Date({{ yesterday.year }}, {{ yesterday.month }}, {{ yesterday.day }}, {{ yesterday.hour }}, {{ yesterday.minute }}, {{ yesterday.second }}),{% endif %}
        {% if today %}'zoomEndTime': new Date({{ today.year }}, {{ today.month }}, {{ today.day }}, {{ today.hour }}, {{ today.minute }}, {{ today.second }}),{% endif %}
      });
    }
  </script>
  {% endif %}
  {% endif %}
  <table class="full">
    <tbody>
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Last Activity</th>
        <th scope="col">Total Traffic</th>
        <th scope="col">Manage</th>
      </tr>
      {% for device in devices %}
      <tr>
        <td><a href="{% url bawebauth.views.show_device device.id %}" title="{{ device.name }}">{{ device.name }}</a></td>
        <td>{% if device.last_usage and device.last_usage.crdate %}{{ device.last_usage.crdate|localedatetime }}{% else %}None{% endif %}</td>
        <td></td>
        <td>{% if device.running %}<img src="{{ STATIC_URL }}icons/loading.gif" alt="{{ device.status }}" title="{{ device.status }}" />{% else %}<a href="{% url bawebauth.views.edit_device device.id %}" title="Edit"><img src="{{ STATIC_URL }}icons/pencil.png" alt="Edit" /></a><a href="{% url bawebauth.views.delete_device_ask device.id %}" title="Delete"><img src="{{ STATIC_URL }}icons/delete.png" alt="Delete" /></a>{% endif %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
